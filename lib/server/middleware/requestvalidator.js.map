{"version":3,"file":"requestvalidator.js","sourceRoot":"","sources":["../../../src/server/middleware/requestvalidator.ts"],"names":[],"mappings":";;AAAA,6DAA4E;AAE5E,qCAAkC;AAElC,MAAM,MAAM,GAAG,IAAI,iBAAO,CAAC,mBAAmB,CAAC,CAAC;AAMhD,2BAA4B,SAAQ,+BAAS;IAC5C;QACC,KAAK,CAAC,GAAG,EAAE,aAAa,CAAC,CAAC;IAC3B,CAAC;CACD;AAED,kBAAkB,IAAY,EAAE,MAAc,EAAE,UAAuB,EAAE,UAAyB;IACjG,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAC,MAAM,EAAC,GAAG,UAAU,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACxD,IAAI,IAAI,GAAW,UAAU,CAAC,CAAC,CAAC,CAAC;QAEjC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACvB,MAAM,CAAC,KAAK,CAAC,iBAAkB,IAAK,kBAAmB,IAAK,QAAS,MAAM,CAAC,WAAW,EAAG,UAAU,EAAE,UAAU,CAAC,CAAC;YAElH,MAAM,IAAI,qBAAqB,EAAE,CAAC;QACnC,CAAC;IACF,CAAC;AACF,CAAC;AAED,yBAAgC,GAAG,UAAoB;IACtD;QACQ,GAAG,CAAC,GAAY,EAAE,GAAa,EAAE,IAAmB;YAC1D,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC;YAE9B,QAAQ,CAAC,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAEtF,IAAI,EAAE,CAAC;QACR,CAAC;KACD;IAED,MAAM,CAAC,eAAe,CAAC;AACxB,CAAC;AAZD,0CAYC;AAED,uBAA8B,GAAG,UAAoB;IACpD;QACQ,GAAG,CAAC,GAAY,EAAE,GAAa,EAAE,IAAmB;YAC1D,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC;YAE3B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACX,MAAM,CAAC,KAAK,CAAC,sBAAuB,MAAM,CAAC,WAAW,EAAG,UAAU,CAAC,CAAC;gBAErE,MAAM,IAAI,qBAAqB,EAAE,CAAC;YACnC,CAAC;YACD,IAAI,CAAC,CAAC;gBACL,QAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;YAC5C,CAAC;YAED,IAAI,EAAE,CAAC;QACR,CAAC;KACD;IAED,MAAM,CAAC,aAAa,CAAC;AACtB,CAAC;AAnBD,sCAmBC","sourcesContent":["import { ExpressMiddlewareInterface, HttpError } from 'routing-controllers';\nimport { Request, Response, NextFunction } from 'express';\nimport { Writeln } from 'writeln';\n\nconst logger = new Writeln('Request Validator');\n\ninterface ICollection {\n\t[key: string]: any;\n}\n\nclass RequestValidatorError extends HttpError {\n\tconstructor() {\n\t\tsuper(400, 'Bad Request');\n\t}\n}\n\nfunction validate(type: string, method: string, collection: ICollection, fieldNames: Array<string>) {\n\tfor (let i = 0, {length} = fieldNames; i < length; i++) {\n\t\tlet name: string = fieldNames[i];\n\n\t\tif (!collection[name]) {\n\t\t\tlogger.error(`Header param \"${ name }\" not found in ${ type } for ${ method.toUpperCase() } request`, collection);\n\n\t\t\tthrow new RequestValidatorError();\n\t\t}\n\t}\n}\n\nexport function HeaderValidator(...fieldNames: string[]): any {\n\tclass HeaderValidator implements ExpressMiddlewareInterface {\n\t\tpublic use(req: Request, res: Response, next?: NextFunction): any {\n\t\t\tlet { headers, method } = req;\n\n\t\t\tvalidate('header', method, headers, fieldNames.map((header) => header.toLowerCase()));\n\n\t\t\tnext();\n\t\t}\n\t}\n\n\treturn HeaderValidator;\n}\n\nexport function BodyValidator(...fieldNames: string[]): any {\n\tclass BodyValidator implements ExpressMiddlewareInterface {\n\t\tpublic use(req: Request, res: Response, next?: NextFunction): any {\n\t\t\tlet { body, method } = req;\n\n\t\t\tif (!body) {\n\t\t\t\tlogger.error(`Body not found for ${ method.toUpperCase() } request`);\n\n\t\t\t\tthrow new RequestValidatorError();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvalidate('body', method, body, fieldNames);\n\t\t\t}\n\n\t\t\tnext();\n\t\t}\n\t}\n\n\treturn BodyValidator;\n}\n"]}