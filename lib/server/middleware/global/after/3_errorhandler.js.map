{"version":3,"file":"3_errorhandler.js","sourceRoot":"","sources":["../../../../../src/server/middleware/global/after/3_errorhandler.ts"],"names":[],"mappings":";;;;;;;;AAEA,6DAAkF;AAElF,qCAAkC;AAElC,MAAM,MAAM,GAAG,IAAI,iBAAO,CAAC,0BAA0B,CAAC,CAAC;AACvD,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,KAAK,CAAC;AAG1C,IAAa,YAAY,GAAzB;IACQ,KAAK,CAAC,KAAU,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB;QACvE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC;QACzC,IAAI,OAAO,GAAG;YACb,KAAK,EAAE;gBACN,IAAI,EAAE,QAAQ;gBACd,OAAO;gBACP,KAAK,EAAE,EAAE;aACT;SACD,CAAC;QAEF,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE;YACrB,KAAK;YACL,OAAO,EAAE,GAAG,CAAC,IAAI;SACjB,CAAC,CAAC;QAEH,EAAE,CAAC,CAAC,GAAG,KAAK,YAAY,CAAC,CAAC,CAAC;YAG1B,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QAC7B,CAAC;QAED,GAAG,CAAC,MAAM,CAAC,QAAQ,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAC3C,CAAC;CACD,CAAA;AAxBY,YAAY;IADxB,gCAAU,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;GACjB,YAAY,CAwBxB;AAxBY,oCAAY","sourcesContent":["// import * as errorhandler from 'errorhandler';\n\nimport { Middleware, ExpressErrorMiddlewareInterface } from 'routing-controllers';\nimport { Request, Response, NextFunction } from 'express';\nimport { Writeln } from 'writeln';\n\nconst logger = new Writeln('Error Handler Middleware');\nconst env = process.env.NODE_ENV || 'dev';\n\n@Middleware({ type: 'after' })\nexport class ErrorHandler implements ExpressErrorMiddlewareInterface {\n\tpublic error(error: any, req: Request, res: Response, next: NextFunction) {\n\t\tlet { httpCode, message, stack } = error;\n\t\tlet payload = {\n\t\t\terror: {\n\t\t\t\tcode: httpCode,\n\t\t\t\tmessage,\n\t\t\t\tstack: {}\n\t\t\t}\n\t\t};\n\n\t\tlogger.error(message, {\n\t\t\terror,\n\t\t\tpayload: req.body\n\t\t});\n\n\t\tif (env !== 'production') {\n\t\t\t// errorhandler()(error, req, res, next);\n\n\t\t\tpayload.error.stack = stack;\n\t\t}\n\n\t\tres.status(httpCode || 500).json(payload);\n\t}\n}\n"]}