{"version":3,"file":"token.js","sourceRoot":"","sources":["../../../../src/common/webclient/auth/token.ts"],"names":[],"mappings":";;AAEA;IAMC;QALO,WAAM,GAAW,IAAI,CAAC;QACtB,YAAO,GAAS,IAAI,CAAC;QAEpB,oBAAe,GAAQ,IAAI,CAAC;QAGnC,IAAI,CAAC,cAAc,EAAE,CAAC;IACvB,CAAC;IAED,IAAI,OAAO;QACV,MAAM,CAAC,IAAI,CAAC,MAAM,KAAK,IAAI,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,IAAI,EAAE,CAAC;IAC3D,CAAC;IAEM,OAAO,CAAC,EAAE,YAAY,EAAE,UAAU,EAAiB;QACzD,IAAI,CAAC,MAAM,GAAG,YAAY,CAAC;QAE3B,IAAI,gBAAgB,GAAG,UAAU,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAEjD,IAAI,CAAC,GAAG,IAAI,IAAI,EAAE,CAAC;QACnB,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,UAAU,EAAE,GAAG,UAAU,GAAG,gBAAgB,CAAC,CAAC;QAE7D,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QAEjB,IAAI,CAAC,cAAc,EAAE,CAAC;IACvB,CAAC;IAKO,aAAa;QACpB,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,KAAK,IAAI,CAAC,CAAC,CAAC;YACnC,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACnC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC7B,CAAC;IACF,CAAC;IAEO,cAAc;QACrB,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC;YAC3B,IAAI,KAAK,GAAW,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;YAElE,IAAI,CAAC,aAAa,EAAE,CAAC;YAErB,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;gBACf,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;oBACjC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBACtB,CAAC,EAAE,KAAK,CAAC,CAAC;YACX,CAAC;YACD,IAAI,CAAC,CAAC;gBACL,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACtB,CAAC;QACF,CAAC;IACF,CAAC;CACD;AArDD,8BAqDC","sourcesContent":["import { IWrappedToken } from '../contracts';\n\nexport abstract class AuthToken {\n\tpublic access: string = null;\n\tpublic expires: Date = null;\n\n\tprivate expiryTimeoutID: any = null;\n\n\tconstructor() {\n\t\tthis.startCountdown();\n\t}\n\n\tget isValid() {\n\t\treturn this.access !== null && this.expires >= new Date();\n\t}\n\n\tpublic refresh({ access_token, expires_in }: IWrappedToken) {\n\t\tthis.access = access_token;\n\n\t\tlet minExpirySeconds = expires_in >= 30 ? 30 : 0;\n\n\t\tlet t = new Date();\n\t\tt.setSeconds(t.getSeconds() + expires_in - minExpirySeconds); // eg 30sec early\n\n\t\tthis.expires = t;\n\n\t\tthis.startCountdown();\n\t}\n\n \tprotected abstract emit(event: string | symbol, ...args: Array<any>): boolean;\n\tprotected abstract on(event: string | symbol, listener: Function): this;\n\n\tprivate stopCountdown() {\n\t\tif (this.expiryTimeoutID !== null) {\n\t\t\tclearTimeout(this.expiryTimeoutID);\n\t\t\tthis.expiryTimeoutID = null;\n\t\t}\n\t}\n\n\tprivate startCountdown() {\n\t\tif (this.expires !== null) {\n\t\t\tlet delay: number = this.expires.getTime() - new Date().getTime();\n\n\t\t\tthis.stopCountdown();\n\n\t\t\tif (delay > 0) {\n\t\t\t\tthis.expiryTimeoutID = setTimeout(() => {\n\t\t\t\t\tthis.emit('expired');\n\t\t\t\t}, delay);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.emit('expired');\n\t\t\t}\n\t\t}\n\t}\n}\n"]}